<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>扩展调试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .test-data {
            background: #fff;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            margin: 10px 0;
            cursor: pointer;
            border: 1px solid #eee;
        }
        .test-data:hover {
            background: #f0f0f0;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .checklist {
            list-style: none;
            padding: 0;
        }
        .checklist li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .checklist li:before {
            content: "❌ ";
            color: #dc3545;
        }
        .checklist li.done:before {
            content: "✅ ";
            color: #28a745;
        }
        .console-output {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>🔧 Enhance Search Buddy 调试页面</h1>
    
    <div class="debug-section">
        <h2>📋 安装检查清单</h2>
        <ul class="checklist">
            <li id="check-extension">扩展已加载到浏览器</li>
            <li id="check-permissions">权限已授予</li>
            <li id="check-popup">弹窗可以打开</li>
            <li id="check-sidepanel">侧边栏可以打开</li>
            <li id="check-hotkey">Alt+L 快捷键工作</li>
            <li id="check-clipboard">剪贴板权限可用</li>
        </ul>
    </div>

    <div class="debug-section">
        <h2>🧪 功能测试数据</h2>
        <p>点击下面的测试数据复制到剪贴板，然后在扩展中测试：</p>
        
        <h3>路径测试</h3>
        <div class="test-data" data-test="path1">D:\Users\Jliu Pureey\Downloads\gitmine\enhance-search-buddy\README.md</div>
        <div class="test-data" data-test="path2">"C:\Program Files\Microsoft Office\Office16\WINWORD.EXE"</div>
        <div class="test-data" data-test="path3">C:\Windows\System32\notepad.exe</div>

        <h3>仓库测试</h3>
        <div class="test-data" data-test="repo1">microsoft/vscode</div>
        <div class="test-data" data-test="repo2">facebook/react</div>
        <div class="test-data" data-test="repo3">https://github.com/openai/gpt-4</div>

        <h3>URL测试</h3>
        <div class="test-data" data-test="url1">https://www.example.com</div>
        <div class="test-data" data-test="url2">https://github.com/microsoft/vscode/issues/123</div>
        <div class="test-data" data-test="url3">https://zread.ai/openai/chatgpt</div>

        <h3>混合内容测试</h3>
        <div class="test-data" data-test="mixed1">这是一段包含链接 https://www.example.com 和路径 D:\test\file.txt 的混合文本，还有仓库 user/repo 等内容。</div>
        <div class="test-data" data-test="mixed2">项目路径：C:\Projects\MyApp\src\main.js，仓库地址：https://github.com/myuser/myapp，联系邮箱：test@example.com</div>

        <h3>文本拆分测试</h3>
        <div class="test-data" data-test="split1">Hello world! This is a test sentence. 这是中文测试。包含数字123和标点符号。</div>
        <div class="test-data" data-test="split2">apple,banana,cherry;orange:grape|watermelon</div>
    </div>

    <div class="debug-section">
        <h2>🚀 快速测试步骤</h2>
        <ol>
            <li><strong>加载扩展</strong>：打开 <code>edge://extensions/</code>，开启开发者模式，加载解压缩的扩展</li>
            <li><strong>测试弹窗</strong>：点击扩展图标，检查弹窗是否正常显示</li>
            <li><strong>测试快捷键</strong>：按 <kbd>Alt+L</kbd>，检查悬浮窗是否出现</li>
            <li><strong>测试侧边栏</strong>：右键扩展图标，选择在侧边栏中打开</li>
            <li><strong>测试功能</strong>：复制上面的测试数据，在扩展中测试各种功能</li>
        </ol>
    </div>

    <div class="debug-section">
        <h2>🐛 常见问题排查</h2>
        <div class="status error">
            <strong>扩展无法加载</strong><br>
            检查 manifest.json 语法是否正确，所有文件路径是否存在
        </div>
        <div class="status error">
            <strong>弹窗空白</strong><br>
            打开开发者工具检查控制台错误，可能是 JavaScript 语法错误
        </div>
        <div class="status error">
            <strong>快捷键不工作</strong><br>
            检查是否与其他扩展或系统快捷键冲突
        </div>
        <div class="status error">
            <strong>剪贴板功能不工作</strong><br>
            检查是否授予了剪贴板读取权限
        </div>
    </div>

    <div class="debug-section">
        <h2>📊 控制台输出</h2>
        <div class="console-output" id="console-output">
            等待测试结果...
        </div>
    </div>

    <script>
        // 测试数据点击复制功能
        document.querySelectorAll('.test-data').forEach(element => {
            element.addEventListener('click', async () => {
                const text = element.textContent.trim();
                try {
                    await navigator.clipboard.writeText(text);
                    element.style.background = '#d4edda';
                    element.style.color = '#155724';
                    setTimeout(() => {
                        element.style.background = '#fff';
                        element.style.color = '';
                    }, 1000);
                    logToConsole(`✅ 已复制: ${text.substring(0, 50)}...`);
                } catch (err) {
                    logToConsole(`❌ 复制失败: ${err.message}`);
                }
            });
        });

        // 控制台日志功能
        function logToConsole(message) {
            const output = document.getElementById('console-output');
            const time = new Date().toLocaleTimeString();
            output.innerHTML += `[${time}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        // 检查扩展状态
        function checkExtensionStatus() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                document.getElementById('check-extension').classList.add('done');
                logToConsole('✅ Chrome 扩展 API 可用');
            } else {
                logToConsole('❌ Chrome 扩展 API 不可用');
            }

            // 检查剪贴板权限
            navigator.permissions.query({name: 'clipboard-read'}).then(result => {
                if (result.state === 'granted') {
                    document.getElementById('check-clipboard').classList.add('done');
                    logToConsole('✅ 剪贴板读取权限已授予');
                } else {
                    logToConsole(`⚠️ 剪贴板权限状态: ${result.state}`);
                }
            }).catch(err => {
                logToConsole(`❌ 无法检查剪贴板权限: ${err.message}`);
            });
        }

        // 页面加载完成后执行检查
        document.addEventListener('DOMContentLoaded', () => {
            logToConsole('🚀 调试页面已加载');
            checkExtensionStatus();
        });

        // 监听键盘事件测试快捷键
        document.addEventListener('keydown', (e) => {
            if (e.altKey && e.key === 'l') {
                logToConsole('🎯 检测到 Alt+L 按键');
            }
        });
    </script>
</body>
</html>