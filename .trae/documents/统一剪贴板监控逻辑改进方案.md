# 统一剪贴板监控逻辑改进方案

## 问题分析

当前实现存在以下问题：
1. **双重监控逻辑**：内容脚本和popup页面都有监控逻辑
2. **复杂的类型管理**：监控类型分为全局和侧边栏两种，导致逻辑复杂
3. **状态同步问题**：开关状态与实际监控状态可能不一致
4. **代码冗余**：popup中存在冗余的监控代码
5. **快捷键处理分散**：快捷键和UI开关可能控制不同的监控逻辑

## 设计原则

- **单一监控逻辑**：仅在内容脚本中实现监控
- **统一开关控制**：所有开关（UI + 快捷键）控制同一个监控实例
- **简化状态管理**：移除不必要的监控类型，统一为单一监控状态
- **保持原有功能**：确保不破坏现有功能

## 改进方案

### 1. 简化内容脚本 (`src/content/index.js`)

- 移除 `monitoringType` 属性，简化监控逻辑
- 统一监控状态管理
- 简化消息处理

### 2. 修改背景脚本 (`src/background/index.js`)

- 简化快捷键处理，移除类型参数
- 统一消息格式

### 3. 清理popup代码 (`src/popup/main.js`)

- 移除冗余的监控逻辑
- 统一开关控制
- 确保开关状态与实际监控状态同步

### 4. 统一消息传递

- 简化消息格式，移除不必要的类型参数
- 确保所有组件使用相同的消息格式

## 实现步骤

1. **修改 `ClipboardMonitor` 类**：
   - 移除 `monitoringType` 属性
   - 简化 `toggleMonitoring` 和 `updateMonitoring` 方法
   - 移除不必要的类型检查

2. **修改背景脚本**：
   - 简化 `toggle_clipboard_monitoring` 命令处理
   - 移除消息中的 `type` 参数

3. **清理popup代码**：
   - 移除 `appState.clipboardInterval` 等冗余状态
   - 统一开关控制逻辑
   - 确保开关状态与实际监控状态同步

4. **测试验证**：
   - 验证UI开关正常工作
   - 验证快捷键正常工作
   - 验证监控功能正常
   - 验证状态同步正常

## 预期效果

- 简化代码结构，提高可维护性
- 统一监控逻辑，避免状态不一致
- 简化开关控制，提高用户体验
- 保持原有功能不变

## 注意事项

- 确保不破坏现有功能
- 确保所有组件之间的状态同步
- 保持良好的代码可读性
- 确保性能不受影响