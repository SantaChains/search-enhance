# Enhance Search Buddy 说明文档

## 项目概述
Enhance Search Buddy 是一个为 Microsoft Edge 浏览器设计的 Manifest V3 扩展。它通过快捷键、侧边栏和弹窗提供强大的文本处理和搜索增强功能，包括智能的悬浮搜索框、多格式文本分析和剪贴板监听。

## 核心功能

### 1. 悬浮搜索框
- **触发**: 浏览网页时按 `Alt+L`。
- **行为**: 在页面右上角弹出一个 iframe 悬浮窗，不会因点击页面空白而消失。
- **关闭**: 再次按 `Alt+L` 或点击悬浮窗内的关闭按钮。

### 2. 搜索与引擎管理
- **主搜索**: 在搜索框输入文本，按回车或点击“搜索”按钮。
- **URL 跳转**: 如果输入的是完整 URL (如 `https://example.com`)，则直接在新标签页打开。
- **自定义引擎**: 支持添加、删除、设置默认搜索引擎（默认为必应 Bing）。
- **引擎列表**: 预设包括必应、谷歌、谷歌学术、秘塔(Metaso)、搜狗。
- **历史记录**: 保存搜索历史，可设置保存条数上限。

### 3. 功能开关

#### 开关 1: 提取和拆解 (Switch 1)
此功能处理文本，提供提取、清洗和拆分能力。
**处理流程**:
1.  **路径识别**:
    -   **输入**: 严格的 Windows 路径格式，带或不带双引号。
        -   例: `D:\\Users\\Jliu Pureey\\Downloads\\gitmine\\Edge-Homepage\\README.md`
        -   例: `"C:\\Program Files\\Microsoft Office\\Office16\\WINWORD.EXE"`
    -   **输出**: 如果识别成功，显示四种格式，每个格式旁有“复制”按钮，顶部有勾选框控制是否用英文双引号包裹。
        1.  原始路径: `D:\\Users\\Jliu Pureey\\Downloads\\gitmine\\Edge-Homepage\\README.md`
        2.  Unix 风格 File URL: `file:///D:/Users/Jliu%20Pureey/Downloads/gitmine/Edge-Homepage/README.md`
        3.  双反斜杠转义路径: `D:\\\\Users\\\\Jliu Pureey\\\\Downloads\\\\gitmine\\\\Edge-Homepage\\\\README.md`
        4.  替代 File URL: `file://D:\\Users\\Jliu Pureey\\Downloads\\gitmine\\Edge-Homepage\\README.md`
    - **注意**: 如果输入被识别为路径，此开关的其他功能（链接提取、文本拆分）将不执行。

2.  **链接提取与文本清洗** (仅在非路径输入时执行):
    -   **步骤 1 - 提取链接**: 从输入文本中找出所有 `http://` 或 `https://` 开头的链接，并在“提取的链接”区域列出。
    -   **步骤 2 - 清洗文本**: 对剩余文本进行一系列处理，为后续拆分做准备。
        -   删除所有中文字符 (`\\u4e00-\\u9fa5`)。
        -   删除中文标点 `，；：？！` (保留 `。`)。
        -   将中文句号 `。` 替换为英文句号 `.`。
        -   删除 `[]` 及其内部的所有内容。
        -   删除所有非英文字母、数字、空格、英文句号的字符。
        -   规范化空格（将多个空格合并为一个）。
    -   **结果**: 得到一个经过清洗的纯英文、数字和英文句号组成的字符串。

3.  **文本拆分工具** (仅在非路径输入时执行):
    -   **输入**: 使用步骤 2 清洗后的文本。
    -   **拆分方式**: 顶部下拉菜单选择，默认为“按英文句子”。
        -   按空格: ` `
        -   按换行: `\\n`
        -   按中文句子: `。！？`
        -   按英文句子: `.!?` (默认)
        -   按标点: `[,.!?;:，。！？；：]`
        -   按单词: 以非单词字符分割
    -   **可视化显示**: 拆分后的片段用方框包围，按行排列。
    -   **行标识**: 每行前有行号和一个勾选框。
    -   **选择方式**:
        -   单击片段可选中/取消选中。
        -   点击行号前的勾选框可选中/取消选中整行。
        -   “全选”勾选框可选中/取消选中所有片段。
    -   **复制控制**:
        -   **分隔符**: 底部有“空格”、“制表符”、“换行符”勾选框。**分隔符优先级**: 换行 > 制表 > 空格。如果勾选多个，只使用最高优先级的一个。
        -   **操作**: 点击“复制选中”按钮，将选中的片段按选定的分隔符连接后复制到剪贴板。
        -   **刷新**: 更改拆分方式或分隔符后，点击“刷新拆分”按钮重新处理和显示。

#### 开关 2: 生成链接 (Switch 2)
此功能处理代码仓库相关的文本。
- **输入**: `用户名/仓库名` 格式 (如 `microsoft/vscode`) 或已知平台的完整仓库链接 (如 `https://github.com/facebook/react`)。
- **输出**: 生成并列出四个平台的对应链接。
    - `https://github.com/{user_repo}`
    - `https://zread.ai/{user_repo}`
    - `https://deepwiki.com/{user_repo}`
    - `https://context7.com/{user_repo}`
- **行为**: 如果输入能被此功能识别，将只显示此功能的结果，不执行 Switch 1 的操作。

#### 开关 3: 多格式分析 (Switch 3)
此功能同时检测并分析输入文本中的多种格式。
- **输入**: 任意文本。
- **检测**:
    -   **路径转换**: 检测 Windows 路径并提供四种格式转换。
    -   **链接提取**: 提取所有 URL 链接。
    -   **仓库链接**: 检测仓库格式并生成多平台链接。
    -   **邮箱地址**: `user@domain.com`
    -   **电话号码**: 中国手机号或固话。
    -   **IP 地址**: IPv4。
- **输出**: 以卡片形式分开展示每种检测到的格式及其结果。

### 4. 剪贴板监听
- **触发**: 点击界面中的剪贴板图标按钮 或 通过设置页开启开关。
- **行为**: 每秒检查一次剪贴板内容，如果内容变化且非空，会自动将内容填入搜索框并触发相应的处理（根据当前激活的开关）。
- **状态**: 按钮图标或开关旁的指示灯会显示监听状态（红色/绿色）。

### 5. 界面入口
- **弹窗 (Popup)**: 点击浏览器工具栏的扩展图标打开。
- **侧边栏 (Side Panel)**: 右键点击扩展图标，选择“在侧边栏中打开”。
- **悬浮窗 (Floating View)**: 按 `Alt+L` 在当前浏览页面打开。

### 6. 设置页面
- **入口**: 弹窗或侧边栏界面中的齿轮图标。
- **功能**:
    -   管理搜索引擎（增删改查、设默认）。
    -   设置历史记录最大保存数量。
    -   清空历史记录。
    -   导出当前配置为 JSON 文件。
    -   从 JSON 文件导入配置。
    -   开启/关闭剪贴板监听。

## 使用流程示例

1.  **启动**: 按 `Alt+L` 打开悬浮窗，或点击扩展图标打开弹窗/侧边栏。
2.  **输入**: 在搜索框中粘贴或输入文本。
3.  **选择功能**:
    *   如果是路径，确保 Switch 1 开启，查看四种格式并复制。
    *   如果是仓库，开启 Switch 2，查看生成的链接。
    *   如果是混合内容或需要拆分，开启 Switch 1，查看提取的链接，然后在清洗后的文本拆分工具中操作。
    *   如果想同时看多种格式，开启 Switch 3。
4.  **操作**: 根据所选功能的界面提示进行复制、选择、拆分等操作。
5.  **结束**: 完成操作后，可以关闭界面。悬浮窗需再次按 `Alt+L` 或点击关闭按钮关闭。

## 技术细节与约束

- **技术栈**: HTML5, CSS3, ES6 JavaScript, Manifest V3。
- **存储**: 使用 `chrome.storage.local` 保存配置和历史记录。**不支持**将数据保存到本地文件系统 (`config.edn`)，这是浏览器安全策略限制。
- **权限**: 申请了 `storage`, `sidePanel`, `activeTab`, `scripting`, `contextMenus`, `clipboardRead` 权限。