# Decide search 扩展实现文档

## 1. 项目概述

Decide search（Search Buddy）是一款强大的浏览器扩展，通过智能文本处理、多格式分析和高级剪贴板监控增强用户的搜索体验。

### 1.1 核心功能

- **智能剪贴板监控**：实时监控剪贴板内容变化，自动记录到历史
- **多格式文本分析**：检测和处理URL、文件路径、邮箱、电话号码等多种格式
- **智能文本拆分**：支持多种分隔规则和内容类型识别
- **搜索引擎集成**：内置多种搜索引擎，支持快速切换
- **链接历史管理**：记录和管理访问过的链接，支持导出和清空
- **仓库链接生成**：从GitHub仓库格式生成多种平台链接
- **路径转换工具**：在不同路径格式之间转换
- **响应式界面**：适配不同屏幕尺寸和布局

### 1.2 技术架构

- **Manifest V3**：使用最新的Chrome扩展开发标准
- **模块化设计**：清晰的代码组织结构
- **后台脚本**：处理上下文菜单和键盘快捷键
- **内容脚本**：处理页面级交互和通知
- **弹出窗口/侧边栏**：提供用户界面
- **工具库**：封装通用功能和逻辑

## 2. 核心功能实现

### 2.1 剪贴板监控系统

#### 2.1.1 功能描述

剪贴板监控系统实时检测剪贴板内容变化，自动记录到历史，并在内容变化时通知用户。支持通过快捷键（Alt+K）和侧边栏开关控制。

#### 2.1.2 实现原理

- **后台监控**：通过`chrome.storage.local`存储监控状态
- **内容脚本通知**：当剪贴板内容变化时，通过消息传递通知内容脚本显示页面通知
- **防抖处理**：使用防抖技术减少频繁的剪贴板检查和通知
- **安全处理**：对大内容进行截断处理，确保性能和稳定性

#### 2.1.3 关键代码

```javascript
// 剪贴板监控类
class ClipboardMonitor {
    constructor() {
        this.isMonitoring = false;
        this.init();
    }

    async init() {
        await this.initializeMonitoringState();
    }

    async handleNewClipboardContent(content) {
        // 安全处理：检查内容长度
        if (content.length > 10000) {
            content = content.substring(0, 100) + '...';
        }
        // 显示通知
        showPageNotification('检测到剪贴板内容变化', 'info');
    }
}

// 检查剪贴板内容
async function checkClipboard() {
    try {
        const text = await readFromClipboard();
        if (!text || text === lastClipboardContent) {
            return; // 内容未变化
        }
        lastClipboardContent = text;
        
        // 防抖处理
        if (clipboardDebounceTimer) {
            clearTimeout(clipboardDebounceTimer);
        }
        
        clipboardDebounceTimer = setTimeout(async () => {
            // 处理剪贴板内容
            await chrome.storage.local.set({
                lastClipboardContent: text,
                clipboardHistoryUpdated: timestamp
            });
            // 添加到剪贴板历史
            await addToClipboardHistory(text, 'clipboard-monitor');
        }, 100);
    } catch (error) {
        logger.error('读取剪贴板失败:', error);
    }
}
```

### 2.2 智能文本处理系统

#### 2.2.1 功能描述

智能文本处理系统提供多种文本分析和处理功能，包括文本提取、链接检测、路径转换、代码命名拆分等。

#### 2.2.2 实现原理

- **多格式检测**：使用正则表达式和模式匹配检测不同类型的内容
- **智能拆分**：根据内容类型自动选择最适合的拆分规则
- **内容转换**：在不同格式之间进行转换，如路径格式转换
- **语义分析**：识别代码命名约定和文本结构

#### 2.2.3 关键代码

```javascript
// 智能文本拆分
export function splitText(text, delimiter = 'en-sentence') {
    if (!text || !text.trim()) return [];
    
    // 支持多规则同时应用
    const delimiters = Array.isArray(delimiter) ? delimiter : [delimiter];
    let results = [text.trim()];
    
    // 按优先级依次应用分隔规则
    for (const rule of delimiters) {
        const newResults = [];
        for (const segment of results) {
            newResults.push(...applySingleSplitRule(segment, rule));
        }
        results = newResults;
    }
    
    // 后处理：去重、过滤、长度校准
    return postProcessSplitResults(results);
}

// 多格式分析
export function analyzeTextForMultipleFormats(text) {
    const results = [];
    
    if (!text || !text.trim()) return results;

    // 路径检测和转换
    const pathResults = processPath(text);
    if (pathResults) {
        results.push({
            type: '路径转换',
            data: pathResults
        });
    }

    // URL提取
    const { extractedLinks } = processTextExtraction(text);
    if (extractedLinks.length > 0) {
        results.push({
            type: '链接提取',
            data: extractedLinks.map(url => ({ url }))
        });
    }

    // 仓库链接生成
    const repoResult = processLinkGeneration(text);
    if (repoResult) {
        results.push({
            type: '仓库链接',
            data: repoResult.generatedLinks.map(url => ({ url }))
        });
    }

    return results;
}
```

### 2.3 链接历史管理

#### 2.3.1 功能描述

链接历史管理系统记录用户访问过的链接，支持分类、搜索、导出和清空操作。特别增强了GitHub仓库的检测和管理。

#### 2.3.2 实现原理

- **增强的历史记录**：记录链接的元数据，如域名、类型、GitHub仓库信息等
-